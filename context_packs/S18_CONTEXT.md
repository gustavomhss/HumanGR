# S18 - cli-base | Context Pack v1.0

---

## PRODUCT REFERENCE

```yaml
product_reference:
  product_id: "HUMANGR"
  product_name: "Human Layer MCP Server"
  wave: "W2-OSSRelease"
  product_pack: "./PRODUCT_PACK.md"
  sprint_index: "./SPRINT_INDEX.yaml"
```

---

## RELOAD ANCHOR

```yaml
sprint:
  id: S18
  name: cli-base
  title: "CLI Base"
  wave: W2-OSSRelease
  priority: P0-CRITICAL
  type: implementation

objective: "CLI com Typer para human-layer command"

source_block: "../MASTER_REQUIREMENTS_MAP.md#PARTE-7-CLI"

dependencies:
  - S14  # Core Engine

deliverables:
  - src/hl_mcp/cli/__init__.py
  - src/hl_mcp/cli/main.py
  - tests/test_cli/test_main.py
```

---

## CLI SPECIFICATION

```yaml
cli:
  name: "human-layer"
  framework: "Typer"
  style: "rich for pretty output"

  commands:
    init: "Initialize configuration"
    validate: "Run validation on action"
    serve: "Start MCP server"
    status: "Show current status"
    version: "Show version"
```

---

## IMPLEMENTATION SPEC

### CLI Main (cli/main.py)

```python
"""Human Layer CLI - Main entry point."""
import typer
from rich.console import Console
from rich.table import Table
from typing import Optional

app = typer.Typer(
    name="human-layer",
    help="7 Layers of Human Judgment for AI Agent Validation",
    add_completion=False,
)
console = Console()


@app.command()
def version():
    """Show version information."""
    from .. import __version__
    console.print(f"[bold]Human Layer[/bold] v{__version__}")


@app.command()
def init(
    config_path: str = typer.Option(
        "human-layer.yaml",
        "--config", "-c",
        help="Path for config file"
    ),
    force: bool = typer.Option(
        False,
        "--force", "-f",
        help="Overwrite existing config"
    ),
):
    """Initialize Human Layer configuration."""
    from pathlib import Path

    config_file = Path(config_path)
    if config_file.exists() and not force:
        console.print(f"[yellow]Config already exists: {config_path}[/yellow]")
        console.print("Use --force to overwrite")
        raise typer.Exit(1)

    default_config = '''# Human Layer Configuration
# Generated by: human-layer init

# LLM Provider (BYOK - Bring Your Own Key)
llm:
  provider: claude  # claude, openai, gemini, ollama
  # api_key loaded from environment

# Layers Configuration
layers:
  HL1:  # UX & Usability
    enabled: true
  HL2:  # Functionality
    enabled: true
  HL3:  # Edge Cases
    enabled: true
  HL4:  # Security
    enabled: true
  HL5:  # Performance
    enabled: true
  HL6:  # Compliance
    enabled: true
  HL7:  # Final Review
    enabled: true

# Triple Redundancy
triple_redundancy: true

# Logging
log_level: INFO
'''
    config_file.write_text(default_config)
    console.print(f"[green]Created config: {config_path}[/green]")


@app.command()
def status():
    """Show Human Layer status."""
    table = Table(title="Human Layer Status")
    table.add_column("Component", style="cyan")
    table.add_column("Status", style="green")

    table.add_row("Config", "Not loaded")
    table.add_row("LLM Provider", "Not configured")
    table.add_row("Layers", "7/7 available")
    table.add_row("Triple Redundancy", "Enabled")

    console.print(table)


@app.command()
def serve(
    transport: str = typer.Option(
        "stdio",
        "--transport", "-t",
        help="Transport: stdio or http"
    ),
    host: str = typer.Option(
        "127.0.0.1",
        "--host", "-h",
        help="Host for HTTP server"
    ),
    port: int = typer.Option(
        8080,
        "--port", "-p",
        help="Port for HTTP server"
    ),
):
    """Start MCP server."""
    import asyncio
    from ..server import create_server

    console.print(f"[bold]Starting Human Layer MCP Server[/bold]")
    console.print(f"Transport: {transport}")

    server = create_server()

    if transport == "stdio":
        console.print("Running on stdio...")
        asyncio.run(server.run_stdio())
    elif transport == "http":
        console.print(f"Running on http://{host}:{port}")
        asyncio.run(server.run_http(host, port))
    else:
        console.print(f"[red]Unknown transport: {transport}[/red]")
        raise typer.Exit(1)


@app.command()
def validate(
    description: str = typer.Argument(..., help="Action description"),
    agent: str = typer.Option(
        "cli-user",
        "--agent", "-a",
        help="Agent ID"
    ),
    action_type: str = typer.Option(
        "general",
        "--type", "-t",
        help="Action type"
    ),
    output_format: str = typer.Option(
        "rich",
        "--format", "-f",
        help="Output format: rich, json"
    ),
):
    """Run validation on an action."""
    console.print(f"[bold]Validating action...[/bold]")
    console.print(f"Agent: {agent}")
    console.print(f"Type: {action_type}")
    console.print(f"Description: {description}")
    console.print()

    # Placeholder - would run actual validation
    table = Table(title="Validation Result")
    table.add_column("Layer", style="cyan")
    table.add_column("Status", style="green")
    table.add_column("Veto", style="yellow")

    table.add_row("HL-1 UX", "PASS", "NONE")
    table.add_row("HL-2 Functionality", "PASS", "NONE")
    table.add_row("HL-3 Edge Cases", "PASS", "NONE")
    table.add_row("HL-4 Security", "PASS", "NONE")
    table.add_row("HL-5 Performance", "PASS", "NONE")
    table.add_row("HL-6 Compliance", "PASS", "NONE")
    table.add_row("HL-7 Final Review", "PASS", "NONE")

    console.print(table)
    console.print()
    console.print("[bold green]DECISION: APPROVED[/bold green]")


def main():
    """Entry point."""
    app()


if __name__ == "__main__":
    main()
```

---

## INTENT MANIFEST

```yaml
INTENT_MANIFEST:
  RF:
    - RF-001: "CLI usa Typer framework"
    - RF-002: "Rich para output formatado"
    - RF-003: "Comandos: init, validate, serve, status, version"
    - RF-004: "Entry point: human-layer"
    - RF-005: "Suporta stdio e HTTP transport"

  INV:
    - INV-001: "init não sobrescreve sem --force"
    - INV-002: "serve default é stdio"
    - INV-003: "validate requer description"
    - INV-004: "Output sempre tem cor"

  EDGE:
    - EDGE-001: "Config existe → warn sem --force"
    - EDGE-002: "Transport inválido → erro"
    - EDGE-003: "Porta ocupada → erro HTTP"
```

---

## GATES

```yaml
gates:
  G0_FILES_EXIST:
    description: "Arquivo existe"
    validation: "ls src/hl_mcp/cli/main.py"

  G1_IMPORTS_WORK:
    description: "Import funciona"
    validation: |
      python -c "from hl_mcp.cli import main"

  G2_TESTS_PASS:
    description: "Testes passam"
    validation: "pytest tests/test_cli/ -v"

  G3_CLI_RUNS:
    description: "CLI executa"
    validation: |
      python -m hl_mcp.cli --help
```

---

## REFERÊNCIA

- `./S14_CONTEXT.md` - Core Engine
- `./S19_CONTEXT.md` - CLI Commands
