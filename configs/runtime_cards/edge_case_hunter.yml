# Runtime Card: Edge Case Hunter
# ================================
# QA Worker: Edge case validation
# Classification: IMPORTANT (failure generates warnings)
#
# Used by: QAMasterOrchestrator._execute_worker("edge_case_hunter")
# Reference: qa_master_orchestrator.py, L5_workers_qa_cerebros.yaml

agent_id: edge_case_hunter
tier: L5_WORKER
classification: IMPORTANT

# Persona for CrewAI agent
role: "Edge Case Validation Specialist"
goal: "Validate that code implementations properly handle edge cases, boundary conditions, and unusual inputs"
backstory: |
  You are an expert at identifying and validating edge case handling in code.
  Your role is to analyze code implementations and verify they properly handle:

  - Boundary conditions (min/max values, empty collections, etc.)
  - Null/None/undefined values
  - Type edge cases (empty strings, zero values, etc.)
  - Concurrency issues (race conditions, deadlocks)
  - Resource limits (memory, connections, etc.)
  - Error conditions and exception handling

  For each edge case from the spec (EDGE), you verify:
  - Is it explicitly handled in the code?
  - Is the handling correct and complete?
  - Are there similar edge cases not in the spec that should be handled?

  You also proactively identify potential edge cases that may have been missed
  in the spec but are relevant to the implementation.

# Task configuration
task_config:
  max_iterations: 5
  timeout_seconds: 300
  output_format: structured

# Input requirements
input_requirements:
  - deliverables: "List of files to analyze"
  - edge_cases: "List of specified edge cases (EDGE)"
  - requirements: "List of requirements for context"

# Output schema
output_schema:
  edge_case_findings:
    type: list
    items:
      edge_case_id: "string (e.g., EDGE-001 or NEW-001 for discovered ones)"
      category: "boundary | null_handling | type_coercion | concurrency | resource | error_handling"
      description: "string"
      status: "HANDLED | PARTIALLY_HANDLED | NOT_HANDLED | INCORRECTLY_HANDLED"
      severity: "HIGH | MEDIUM | LOW"
      location: "file:line"
      evidence: "string (code snippet or explanation)"
      fix_hint: "string"
  discovered_edge_cases:
    type: list
    items:
      category: "string"
      description: "string"
      potential_impact: "string"
      suggested_handling: "string"
  coverage:
    specified_handled: integer
    specified_total: integer
    discovered_count: integer
  summary:
    type: string
  passed:
    type: boolean

# Stacks to use
stacks:
  - got
  - buffer_of_thoughts
  - qdrant_hybrid
  - ragas
  - langfuse

# =============================================================================
# F4-001: SQUAD MEMORY INTEGRATION (2026-02-01)
# =============================================================================
squad_memory:
  enabled: true
  squad_id: "qa_squad"
  role: "worker"
  squad_lead: "qa_master"

  readable_segments:
    - "edge_cases_catalog"
    - "common_bugs"
    - "code_quality_patterns"

  submittable_findings:
    - "edge_case"
    - "boundary_condition"

  awareness_prompt: |
    SQUAD MEMORY: Voce faz parte do qa_squad liderado por qa_master.
    Use os edge cases catalogados pelo squad para informar sua analise.
    Suas descobertas significativas serao enviadas ao squad lead automaticamente.


# =============================================================================
# RAG STACKS INTEGRATION (2026-02-01)
# =============================================================================
# RAG stacks for edge case detection and validation
rag_stacks:
  self_rag:
    enabled: true
    priority: 1
    use_cases:
      - "Retrieve known edge case patterns"
      - "Find boundary condition examples"
      - "Query error handling patterns"
    parameters:
      critique_response: true
      min_confidence: 0.75

  graphrag:
    enabled: true
    priority: 2
    use_cases:
      - "Map data flow to find edge conditions"
      - "Understand input transformation paths"
      - "Trace error propagation"
    parameters:
      include_reasoning_steps: true
      top_k: 8

  colbert:
    enabled: true
    priority: 3
    use_cases:
      - "Find null check patterns"
      - "Match boundary validation code"
      - "Locate exception handlers"
    parameters:
      top_k: 10

  qdrant_hybrid:
    enabled: true
    priority: 4
    use_cases:
      - "Search edge case documentation"
      - "General pattern search"
    parameters:
      collection_name: "edge_cases"
      top_k: 5

  corrective_rag:
    enabled: false
    reason: "Bug fixing delegated to auditor"

  memo_rag:
    enabled: false
    reason: "Worker receives context from squad memory"

  raptor_rag:
    enabled: false
    reason: "Hierarchical docs not needed for edge case hunting"

  awareness_prompt: |
    RAG STACKS: Voce tem acesso a 4 RAG stacks para caca de edge cases.
    PRIORIDADE: Self-RAG > GraphRAG > ColBERT > Qdrant
    Use Self-RAG para buscar padroes de edge cases conhecidos.
    Use GraphRAG para entender fluxos de dados e encontrar limites.
    EDGE CASE HUNTER: valide TODOS os EDGE do spec e descubra novos.

# =============================================================================
# GRAPH STACKS INTEGRATION (2026-02-01)
# =============================================================================
# ALL 6 graph stacks configured for this agent with role-specific operations.
# Access via GraphStackOrchestrator with FAIL-CLOSED pattern.
graph_stacks:
  # FalkorDB - Knowledge graph for evidence and relationships
  falkordb_enabled: true
  falkordb_operations:
    - "traverse"
    - "execute_optimized"

  # Neo4j Enhanced - Vector search and GDS algorithms
  neo4j_enabled: true
  neo4j_operations:
    - "similarity_search"
    - "create_vector_index"

  # Neo4j Algorithms - PageRank, community detection, clustering
  neo4j_algorithms_enabled: true
  neo4j_algorithms_operations:
    - "run_pagerank"
    - "detect_communities"
    - "claim_clustering"

  # Neo4j Analytics - Advanced claim/source analysis
  neo4j_analytics_enabled: true
  neo4j_analytics_operations:
    - "trace_claim_propagation"
    - "get_claim_verification_chain"
    - "analyze_source_credibility"

  # GoT Enhanced - Multi-path reasoning and thought graphs
  got_enabled: true
  got_operations:
    - "analyze_multi_perspective"
    - "build_reasoning_graph"
    - "aggregate_thoughts"

  # Graphiti - Temporal knowledge graph for facts over time
  graphiti_enabled: true
  graphiti_operations:
    - "query_temporal"
    - "get_fact_history"
    - "get_active_facts"
